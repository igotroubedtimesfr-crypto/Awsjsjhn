--// Lib
local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/cueshut/saves/main/criminality%20paste%20ui%20library"))()

--// Window
local window = library.new("Paulo.lol | Camlock + Silent Aim", "paulo_config")

--// Aba Main
local tab = window.new_tab("rbxassetid://4483345998")
local section = tab.new_section("Main")
local aiming = section.new_sector("Camlock", "Left")

--// Config Camlock
local config = {
    camlock = false,
    predictionX = 0.135,
    predictionY = 0.135,
    jumpOffset = 0,
    airOffset = 0,
    smoothness = 0.2,
    hitPart = "Head"
}

--// Config Silent Aim
getgenv().SilentSettings = {
    FOV = 120,
    CircleColor = Color3.fromRGB(0, 100, 255),
    LineColor = Color3.fromRGB(0, 100, 255),
    Prediction = 0.13,
    TargetPart = "HumanoidRootPart"
}

local SilentMode = false
local FOVVisible = true

--// Drawing FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Radius = getgenv().SilentSettings.FOV
FOVCircle.Thickness = 1.5
FOVCircle.Color = getgenv().SilentSettings.CircleColor
FOVCircle.Filled = false
FOVCircle.Visible = false
FOVCircle.Position = workspace.CurrentCamera.ViewportSize/2

local AimLine = Drawing.new("Line")
AimLine.Thickness = 1.5
AimLine.Color = getgenv().SilentSettings.LineColor
AimLine.Visible = false

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera
local target = nil

--// Função pegar player mais próximo (Camlock)
local function getClosestPlayer()
    local mousePos = UserInputService:GetMouseLocation()
    local closest, closestDist = nil, math.huge
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= localPlayer and plr.Character and plr.Character:FindFirstChild(config.hitPart) then
            local screenPos, onScreen = camera:WorldToViewportPoint(plr.Character[config.hitPart].Position)
            if onScreen then
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                if dist < closestDist then
                    closestDist = dist
                    closest = plr
                end
            end
        end
    end
    return closest
end

--// Camlock UI
aiming.element("Toggle", "Enabled", false, function(v)
    config.camlock = v.Toggle
    if config.camlock then
        target = getClosestPlayer()
    else
        target = nil
    end
end)

aiming.element("TextBox", "Horizontal Prediction", {default = tostring(config.predictionX)}, function(v)
    config.predictionX = tonumber(v.Text) or config.predictionX
end)
aiming.element("TextBox", "Vertical Prediction", {default = tostring(config.predictionY)}, function(v)
    config.predictionY = tonumber(v.Text) or config.predictionY
end)
aiming.element("TextBox", "Jump Offset", {default = tostring(config.jumpOffset)}, function(v)
    config.jumpOffset = tonumber(v.Text) or config.jumpOffset
end)
aiming.element("TextBox", "Air Offset", {default = tostring(config.airOffset)}, function(v)
    config.airOffset = tonumber(v.Text) or config.airOffset
end)
aiming.element("TextBox", "Smoothness", {default = tostring(config.smoothness)}, function(v)
    config.smoothness = tonumber(v.Text) or config.smoothness
end)

aiming.element("Dropdown", "Aim Part", {options = {"Head","HumanoidRootPart","Torso"}}, function(v)
    config.hitPart = v.Dropdown
end)

--// Silent Aim Sector
local silentSector = section.new_sector("Silent Aim", "Left")

silentSector.element("Toggle", "Silent Mode", false, function(v)
    SilentMode = v.Toggle
    if SilentMode then
        FOVCircle.Visible = FOVVisible
    else
        FOVCircle.Visible = false
        AimLine.Visible = false
    end
end)

silentSector.element("Toggle", "FOV Show", true, function(v)
    FOVVisible = v.Toggle
    FOVCircle.Visible = SilentMode and FOVVisible
    AimLine.Visible = SilentMode and FOVVisible
end)

silentSector.element("TextBox", "FOV Size", {default = tostring(getgenv().SilentSettings.FOV)}, function(v)
    local newFOV = tonumber(v.Text)
    if newFOV then
        getgenv().SilentSettings.FOV = newFOV
        FOVCircle.Radius = newFOV
    end
end)

--// Silent Aim Funções
local function GetClosest()
    local closestPlayer = nil
    local shortestDistance = getgenv().SilentSettings.FOV
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild(getgenv().SilentSettings.TargetPart) then
            local pos, visible = camera:WorldToViewportPoint(player.Character[getgenv().SilentSettings.TargetPart].Position)
            if visible then
                local dist = (Vector2.new(pos.X, pos.Y) - (camera.ViewportSize/2)).magnitude
                if dist < shortestDistance then
                    shortestDistance = dist
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

--// Hook Silent Aim (__index)
local mt = getrawmetatable(game)
local old = mt.__index
setreadonly(mt, false)
mt.__index = newcclosure(function(t, k)
    if SilentMode and t == localPlayer:GetMouse() and (k == "Hit" or k == "Target") then
        local closest = GetClosest()
        if closest and closest.Character and closest.Character:FindFirstChild(getgenv().SilentSettings.TargetPart) then
            local part = closest.Character[getgenv().SilentSettings.TargetPart]
            local predPos = part.Position + (part.Velocity * getgenv().SilentSettings.Prediction)
            local screenPos = camera:WorldToViewportPoint(predPos)
            AimLine.Visible = SilentMode and FOVVisible
            if AimLine.Visible then
                AimLine.From = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                AimLine.To = Vector2.new(screenPos.X, screenPos.Y)
            end
            return (k == "Hit" and CFrame.new(predPos) or part)
        else
            AimLine.Visible = false
        end
    end
    return old(t, k)
end)
setreadonly(mt, true)

--// Loops
RunService.RenderStepped:Connect(function()
    -- Camlock
    if config.camlock and target and target.Character and target.Character:FindFirstChild(config.hitPart) then
        local hrp = target.Character[config.hitPart]
        local predicted = hrp.Position 
            + hrp.Velocity * Vector3.new(config.predictionX, config.predictionY, config.predictionX) 
            + Vector3.new(0, config.airOffset + config.jumpOffset, 0)
        camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, predicted), config.smoothness)
    end

    -- Silent Aim FOV follow
    if SilentMode then
        FOVCircle.Position = camera.ViewportSize/2
    end
end)
